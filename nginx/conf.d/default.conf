server {
    listen 80;
    server_name localhost;

    # El directorio raíz de tu proyecto Laravel
    root /var/www/backend/public;

    # El índice predeterminado
    index index.php;

    # Permite rutas personalizadas de Laravel
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Bloque para procesar archivos PHP con PHP-FPM
    location ~ \.php$ {
        # Importa los parámetros FastCGI de Nginx
        include fastcgi_params;

        # Pasa las peticiones PHP al servicio 'app' en el puerto 9000
        fastcgi_pass app:9000;

        # Establece la ruta correcta del script PHP
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    # Bloquea el acceso a archivos ocultos (por seguridad)
    location ~ /\. {
        deny all;
    }
}